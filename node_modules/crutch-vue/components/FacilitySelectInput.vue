<template>
    <div :class="groupClass">
        <label :class="labelClass" :for="selectId">{{ label }}</label>
        <select :id="selectId" class="form-select" :disabled="disableSelect" :class="selectClass" v-model="activeFacility" @change="selectionChanged">
            <option v-for="(facility, index) in facs" :key="index" :value="facility">
                {{ facility.Address.Name }}
            </option>
        </select>
    </div>
</template>



<script lang="ts">
    import { defineComponent, ref } from 'vue';

    const AllFacility = {
        FacilityIdString: "All",
        Address: {
            Name: "All",
        },
    };

    const FacilitySelectInput = defineComponent({
        name: 'FacilitySelectInput',
        props: {
            facilities: { type: Array, default: [] },
            activeFacility: { type: String, default: null },
            showAllOption: { type: Boolean, default: false },
            disableSelect: { type: Boolean, default: false },
            selectClass: { type: String, default: '' },
            label: { type: String, default: 'Facility' },
            labelClass: { type: String, default: 'mb-tight' },
            groupClass: { type: String, default: '' },
            selectId: { type: String, default: 'facilitySelect' },
        },
        setup(props: any, context: any) {
            const selectionChanged = function () {
                context.emit("facilitySelected", activeFacility.value);
            }

            let facs = [];

            if (props.showAllOption) {
                facs.push(AllFacility);
            }

            //@ts-ignore
            props.facilities.forEach(fac => {
                facs.push(fac);
            });


            const activeFacility = ref(facs.find(fac => fac.FacilityIdString === props.activeFacility));
            return {
                facs,
                activeFacility,
                selectionChanged,
            }
        }
    });

    export default FacilitySelectInput
</script>